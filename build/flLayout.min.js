/*
 Ruaidhr? Devery
 (c) 2010-2012 Fluid Media. http://fluid.ie
 License: MIT
*/
(function(M,g){'use strict';function r(b){return g.isString(b)||q(b)}function q(b){return b!=null&&typeof b!="boolean"&&!g.isArray(b)&&g.isNumber(Number(b))&&!isNaN(b)}function B(){this.$get=["$injector","$parse","$window",function(b,c,e){return function(a,d,h){var f=h?h.$scope:{};g.isString(a)&&(a=c(a),a=a(f)||a(e));var f=a.prototype,j;for(j in f)d[j]=g.bind(d,f[j]);return b.invoke(a,d,h)}}]}function C(){var b=[];this.addSuiteClass=function(c){b.push(c)};this.addSuiteClass(D);this.$get=["$exceptionHandler",
function(c){function e(a,b){function f(a,c){function b(){a.apply(this);c.apply(this)}function d(){}d.prototype=g.extend({},a.prototype,c.prototype);b.prototype=new d;return b}function e(a,b){g.isString(a)&&(a=a.replace(/^\s+|\s+$/g,"")).length>0||c("Cannot bind "+b+" property '"+a+"'");return a}function o(){this.transitionProps={};this.onCue=!1}var l=this,k=[],p=!1,i,m=[],n={};m.push(a.$watch(function(){if(p){for(var a,c=0;c<k.length;c++)if(a=k[c],a.onCue)a.fire(b,i),a.onCue=!1;i&&g.isFunction(i.afterFire)&&
i.afterFire();i=void 0;p=!1}}));a.$on("$destroy",function(){l.dispose()});this.states={};this.bindings={};this.state=function(a){a=l.states[a];l.apply(a.props,a.params)};this.state.config=function(a,c,b){l.states[a]={props:c,params:b||{}}};this.dispose=function(){g.forEach(m,function(a){a()});b=a=i=m=null};this.bind=function(b,f){var h,i;if(g.isObject(b))for(i in b)l.bind(i,b[i]);else h=e(b,"scope"),f=e(f,"transition"),l.bindings.hasOwnProperty(h)||(m.push(a.$watch(h,function(a,b){var d;a:{var f;
(d=l.bindings[h])||c("Transition: No transition binding found for "+h+" but one was expected");for(var e=0;e<k.length;e++)if(f=k[e],f=f.transitionProps[d],g.isFunction(f)){d=f;break a}d=g.noop}d(a,b);p=!0})),n[h]=m[m.length-1]),l.bindings[h]=f};this.unbind=function(a){if(g.isArray(a))g.forEach(a,function(a){l.unbind(a)});else{var b=n[a];if(g.isFunction(b)){b();n[a]=null;for(var c=m.length-1;c>=0;c--)if(m[c]===b){m.splice(c,1);break}}l.bindings[a]=null}};this.apply=function(b,c){var f,e;if(g.isFunction(b))b.call(a);
else{for(f in b)e=b[f],a[f]=g.isFunction(e)?e.call(a):e;i=c||{}}};this.addSuite=function(a){var b=new (f(o,a));g.isFunction(b.fire)||c("Transition suite ["+a.name+"] Class must have a 'fire' instance method.");k.unshift(b)};o.prototype={register:function(a,b){var f=this;g.forEach(["noop"],function(b){a==b&&c("Cannot register transition property '"+a+"' it is reserved.")});this.transitionProps[a]=function(a,c){if(b(a,c)!==!1)f.onCue=!0}}}}var a=0;return function(c,h){var f=new e(c,h);f.id="transition_"+
++a;for(var g=0;g<b.length;g++)f.addSuite(b[g]);return f}}]}function E(){this.$get=["$window","$rootScope","$timeout",function(b,c,e){function a(){e(function(a){return function(){a<d||c.$apply(d)}}(++d),h,!1)}var d=0,h;return function(c){if(h!=(c||50))g.element(b).unbind("resize",a),g.element(b).bind("resize",a)}}]}function s(b,c){function e(){a.layout()}var a=this,d,h=!1,f=this.layoutScope=b,j=[],o={},l=[];this.addChild=function(b,f){(f=a.validateAndTrim(f))?o.hasOwnProperty(f)&&c("Sorry but this Layout Container already has a child with the name '"+
f+"'"):f=a.getUniqueID("child_"+(l.length+1),l);l.push(f);b.$on("reflow",e);j.push(b);o[f]=b;return f};this.layout=function(a){g.isFunction(a)?d=a:arguments.length==0&&!h&&(f.$evalAsync(function(){d(j,f);h=!1}),h=!0)};this.defaultLayout=function(){return g.noop};this.setLayoutScope=function(b){k.setLayoutScope&&k.setLayoutScope(b);a.layoutScope=f=b};this.reflow=function(){k.reflow&&k.reflow();a.layout()};this.getUniqueID=function(b,c,f){var d=1,e=b;if(!g.isString(b=a.validateAndTrim(b)))e=f,b=e+d++;
for(;c.indexOf(b)>-1;)b=e+d++;return b};this.validateAndTrim=function(a){if(!g.isString(a))return!1;a=a.replace(/^\s+|\s+$/g,"");return a.length==0?!1:a};this.init=function(){f.children=j;f.childrenByName=o;f.reflow=function(){a.reflow()};a.layout(a.defaultLayout())};var k=this._super||{};this._super=g.extend({},k,{init:a.init,addChild:a.addChild,layout:a.layout,reflow:a.reflow,defaultLayout:a.defaultLayout,setLayoutScope:a.setLayoutScope,getUniqueID:a.getUniqueID,validateAndTrim:a.validateAndTrim})}
function t(b,c){var e=this,a={},d=b;this.addReflowWatcher=function(b){g.isString(b)||c("You can only add a string expression as a reflow watcher");a.hasOwnProperty(b)||(a[b]=d.$watch(b,function(){e.reflow()}))};this.removeReflowWatcher=function(b){var c=a[b];try{c()}catch(d){}delete a[b]};this.reflow=function(){h.reflow&&h.reflow();d.$emit("reflow")};this.setLayoutScope=function(a){h.setLayoutScope&&h.setLayoutScope(a);e.layoutScope=d=a};this.init=function(){d.reflow=function(){e.reflow()}};var h=
this._super||{};this._super=g.extend({},h,{reflow:e.reflow,setLayouScope:e.setLayoutScope,transitionIn:e.transitionIn,transitionInComplete:e.transitionInComplete,transitionOut:e.transitionOut,transitionOutComplete:e.transitionOutComplete})}function u(b,c,e){var a=this,d=this.layoutScope=b.$new(!0),h=this.transition=e(d,c);h.state.config("init",{hidden:!0});h.state.config("show",{hidden:!1},{onComplete:function(){a.transitionInComplete()}});h.state.config("hide",{hidden:!0},{onComplete:function(){a.transitionOutComplete()}});
h.bind({hidden:"css-hidden"});d.calculateHeight=function(){return d.hidden?0:d.height};d.calculateWidth=function(){return d.hidden?0:d.width};d.transState="initializing";this.transitionIn=function(){d.transState="transitioningIn";h.state("show")};this.transitionInComplete=function(){d.transState="transitionedIn"};this.transitionOut=function(){d.transState="transitioningOut";h.state("hide")};this.transitionOutComplete=function(){d.transState="transitionedOut"};this.init=function(){h.state("init")};
this._super=g.extend({},this._super||{},{transitionIn:a.transitionIn,transitionInComplete:a.transitionInComplete,transitionOut:a.transitionOut,transitionOutComplete:a.transitionOutComplete});g.isFunction(a.setLayoutScope)&&this.setLayoutScope(d)}function v(b,c){function e(){var a=this,d=[],e=Array.prototype.slice.call(arguments);b.apply(this,e.slice(0,b.$inject.length));d.push(this.init||g.noop);c.apply(this,e.slice(b.$inject.length));d.push(this.init||g.noop);this.init=function(){g.forEach(d,function(b){b.call(a)})}}
function a(){}var d=Array.prototype.slice.call(arguments);a.prototype=g.extend({},b.prototype,c.prototype);e.prototype=new a;e.$inject=[].concat(b.$inject).concat(c.$inject);d.length>2&&(e=extendLayoutController.apply(null,[e].concat(d.slice(2))));return e}function w(b,c,e,a,d){var h=this.transition=a(b,c),f=e.withController,j;this.addReflowWatcher("calculateHeight()");this.addReflowWatcher("calculateWidth()");h.state.config("init",{height:0});h.bind("height","css-height");h.bind("y","css-y");c.css("width",
"100%");c.css("overflow-x","hidden");c.css("overflow-y","hidden");c.css("position","absolute");b.calculateHeight=function(){return b.height};b.calculateWidth=function(){return b.width};this.defaultLayout=function(){return function(a,b){var c=0,d=0;g.forEach(a,function(a){c+=a.calculateHeight();d=Math.max(a.calculateWidth(),d)});b.height=c;b.width=d}};this.init=function(){g.isString(f)&&f.length>0&&(j={$scope:b,$element:c,$attrs:e,$trans:h},d(f,this,j));h.state("init")};this._super=g.extend({},this._super||
{},{defaultLayout:this.defaultLayout})}function x(b,c,e,a,d){var h=this.transition=a(b,c),f=e.withController,j;h.state.config("init",{height:0});h.bind("height","css-height");c.css("width","100%");c.css("position","relative");this.defaultLayout=function(){return function(a,b){var c=0,d=0;g.forEach(a,function(a){a.y=c;c+=a.calculateHeight();d=Math.max(d,a.calculateWidth())});b.height=c;b.width=d}};this.init=function(){g.isString(f)&&f.length>0&&(j={$scope:b,$element:c,$attrs:e,$trans:h},d(f,this,j))};
this._super=g.extend({},this._super||{},{defaultLayout:this.defaultLayout})}function y(b,c,e,a){var d=this.layoutScope,h=this.transition,f,j=e.withController;this.addReflowWatcher("displaying()");this.addReflowWatcher("calculateHeight()");this.addReflowWatcher("calculateWidth()");c.css("width","100%");c.css("display","block");c.css("position","absolute");d.calculateHeight=function(){return d.displaying()?d.height:0};d.calculateWidth=function(){return d.displaying()?d.width:0};d.show=function(a){a=
a||d.name;b._block.currentScreen=a};d.hide=function(){if(d.displaying())b._block.currentScreen=null};d.displaying=function(){return b._block.currentScreen==d.name};this.init=function(){g.isString(j)&&j.length>0&&(f={$scope:b,$element:c,$attrs:e,$trans:h},a(j,this,f))};this._super=g.extend({},this._super||{},{})}function z(b,c,e,a,d){var h=this,f=this.layoutScope,j=this.transition,o=c.withController,l;e.css("width","100%");e.css("height","100%");e.css("overflow-x","hidden");e.css("overflow-y","hidden");
e.css("position","absolute");e.css("z-index","100");e.css("top","0px");e.css("left","0px");f.show=function(a){a=a||f.name;if(b._parent.overlay_register.contains(a))b._parent.currentOverlay=a};f.hide=function(){b._parent.currentOverlay=null};f.displaying=function(a){a=a||f.name;return b._parent.currentOverlay==a};this.init=function(){var k=b._parent;if(!k.overlay)k.overlay_register=layout_component_utils.new_registry("Overlay Register"),k.overlay=function(a){var b=this.overlay_register;return g.isDefined(a)?
(b.contains(a)||d("Overlay with name'"+a+"' not found"),b.get(a)):g.isString(this.currentOverlay)?(b.contains(this.currentOverlay)||d("The current overlay value is not a registered overlay name"),b.get(this.currentOverlay)):b.first()};f.name=h.getUniqueID(c.withName,k.overlay_register.ids,"overlay_");k.overlay_register.add(f.name,f);g.isString(o)&&o.length>0&&(l={$scope:b,$element:e,$attrs:c,$trans:j},a(o,this,l))};this._super=g.extend({},this._super||{},{})}function A(b,c,e){var a=b._panel=this.layoutScope,
d=this.transition;c.css("position","absolute");c.css("display","block");d.bind({x:"css-x",y:"css-y"});a.align=e.anOverlayPanel;a.reposition=function(){var c=b._overlay&&b._overlay.width||0,d=b._overlay&&b._overlay.height||0,e=a.width||0,g=a.height||0;switch(a.align){case "right":case "topright":case "bottomright":a.x=c-e;break;case "left":case "topleft":case "bottomleft":a.x=0;break;default:a.x=(c-e)*0.5}switch(a.align){case "bottom":case "bottomleft":case "bottomright":a.y=d-g;break;case "top":case "topleft":case "topright":a.y=
0;break;default:a.y=(d-g)*0.5}};this.init=function(){}}function F(){var b=this;this.props={};this.register("slidey-x",function(c){if(!r(c))return!1;c=q(c)?c.toString()+"px":c;b.props.left=c});this.register("slidey-y",function(c){if(!r(c))return!1;c=q(c)?c.toString()+"px":c;b.props.top=c});this.register("slidey-width",function(c){if(!r(c))return!1;c=q(c)?c.toString()+"px":c;b.props.width=c});this.register("slidey-height",function(c){if(!r(c))return!1;c=q(c)?c.toString()+"px":c;b.props.height=c});this.register("slidey-opacity",
function(c){if(!q(c))return!1;b.props.opacity=c});this.fire=function(c,e){var a=e&&e.duration||300,d=e&&e.onComplete||g.noop;$(c).animate(b.props,{duration:a,queue:!1},d);b.props={}}}function D(){var b={},c,e;this.register("css-x",function(a){if(!r(a))return!1;a=q(a)?a.toString()+"px":a;b.left=a});this.register("css-y",function(a){if(!r(a))return!1;a=q(a)?a.toString()+"px":a;b.top=a});this.register("css-width",function(a){if(!r(a))return!1;a=q(a)?a.toString()+"px":a;b.width=a});this.register("css-height",
function(a){if(!r(a))return!1;a=q(a)?a.toString()+"px":a;b.height=a});this.register("css-hidden",function(a){c=a?"hide":"show"});this.register("css-opacity",function(a){if(!q(a))return!1;b.opacity=a;b["-moz-opacity"]=a;b.filter="alpha(opacity="+Math.round(a*100)+")"});this.fire=function(a,d){var h=d&&d.onComplete||g.noop;!e&&a.css("display")!="none"&&(e=a.css("display"));switch(c){case "show":b.display=e?e:"block";break;case "hide":b.display="none"}a.css(b);c=null;b={};h()}}if(!Array.indexOf)Array.prototype.indexOf=
function(b){for(var c=0;c<this.length;c++)if(this[c]==b)return c;return-1};s.$inject=["$scope","$exceptionHandler"];t.$inject=["$scope","$exceptionHandler"];u.$inject=["$scope","$element","transition"];w.$inject=["$scope","$element","$attrs","transition","augmentController"];var G=function(){return{restrict:"EA",scope:{},require:["^aLayout","aBlock"],transclude:!0,template:'<div class="a-block" ng-transclude></div>',replace:!0,controller:extendController(s,t,w),link:function(b,c,e,a){var d=a[0],h=
a[1];b.name=d.addChild(b,e.withName);h.init();b.$on("$destroy",function(){h=d=null})}}};x.$inject=["$scope","$element","$attrs","transition","augmentController"];var H=["windowResizeWatcher",function(b){return{restrict:"EA",scope:{},transclude:!0,template:'<div class="a-layout" ng-transclude></div>',replace:!0,controller:v(s,x),link:function(c,e,a,d){c.name=a.withName;b();d.init()}}}];y.$inject=["$scope","$element","$attrs","augmentController"];var I=["$compile","$jQuery",function(b,c){return{restrict:"EA",
scope:!0,require:["^aLayout","^aBlock","aScreen"],controller:v(t,u,y),compile:function(e){var a='<div class="a-screen-content" style="display: inline-block; width: 100%;">'+e.html()+"</div>";e.html("");return function(d,e,f,g){function o(c){c?(n&&n.$destroy(),n=d.$new(),e.html(a),b(e.contents())(n),l.transitionIn()):l.transitionOut()}var l=g[2],k=g[1],p=g[0],i=d._screen=l.layoutScope,m=d._block=k.layoutScope;d._layout=p.layoutScope;i.name=k.addChild(i,f.withName);var n;i.$watch("displaying()",function(a,
b){a!=b&&o(a)});i.$watch(function(){return c(e).children(".a-screen-content").height()},function(a){i.height=a});i.$watch(function(){return c(e).children(".a-screen-content").width()},function(a){i.width=a});d.$on("transitionedOut",function(){n&&(n.$destroy(),n=null);e.html("")});l.init();m.currentScreen||(i.show(),o(!0));d.$on("$destroy",function(){i=m=l=k=p=null;d._layout=d._block=d._screen=null})}}}}];z.$inject=["$scope","$attrs","$element","augmentController","$exceptionHandler"];var J=["$compile",
"$exceptionHandler","$jQuery",function(b,c){return{restrict:"EA",scope:!0,require:["^?aLayout","^?aBlock","^?aScreen","anOverlay"],controller:v(s,u,z),compile:function(e){var a=e.html();e.html("");return function(d,e,f,j){function o(){g.forEach(n,function(a){a()});n=[]}function l(){m&&(m.$destroy(),m=null);e.html("")}for(var k,p,i,m,n=[],f=0;f<3;f++)if(j[f])i=j[f].layoutScope;i||c("No parent scope found!");d._parent=i;k=j[3];p=d._overlay=k.layoutScope;p.$watch("displaying()",function(c,f){c!=f&&(c?
(m&&m.$destroy(),m=d.$new(),e.html(a),b(e.contents())(m),k.transitionIn()):k.transitionOut())});d.$on("transitionedOut",l);d.$on("$destroy",function(){l();i.overlay_register.clear();i.currentOverlay=null;p.$destroy();k=p=i=null});k.init();(function(){o();n.push(i.$watch("height",function(a){p.height=a}));n.push(i.$watch("width",function(a){p.width=a}));n.push(i.$watch("transState",function(a){switch(a){case "transitionedIn":p.height=i.height;p.width=i.width;break;case "transitioningOut":o()}}))})()}}}}];
A.$inject=["$scope","$element","$attrs"];var K=["$jQuery",function(b){return{restrict:"EA",transclude:!0,template:"<div class='an-overlay-panel'><div class='an-overlay-panel-content' style='display: inline-block; width: 100%;' ng-transclude></div></div>",replace:!0,controller:v(t,u,A),link:function(c,e,a,d){function h(){g.forEach(j,function(a){a()});j=[]}var f=c._panel,j=[];f.$watch("width+'~'+height+'~'+align",function(){f.transState=="transitionedIn"&&f.reposition()});c.$watch(function(){return b(e).children(".an-overlay-panel-content").height()},
function(a){f.height=a});c.$watch(function(){return b(e).children(".an-overlay-panel-content").width()},function(a){f.width=a});c.$on("$destroy",function(){f.$destroy();f=null;d.layoutScope.$destroy()});d.init();d.transitionIn();(function(){h();j.push(c._overlay.$watch("width+'~'+height",function(){c._overlay.transState=="transitionedIn"&&f.reposition()}));j.push(c._overlay.$watch("transState",function(a){switch(a){case "transitionedIn":f.width=b(e).children(".an-overlay-panel-content").width();f.height=
b(e).children(".an-overlay-panel-content").height();f.reposition();e.css("top",f.y);e.css("left",f.x);break;case "transitioningOut":h()}}))})()}}}],L=function(){return{require:["?aLayout","?aBlock","?aScreen","?anOverlay","?anOverlayPanel"],link:function(b,c,e,a){var d=e.beSlidey.split(","),a=a||[],h={x:"slidey-x",y:"slidey-y",width:"slidey-width",height:"slidey-height",opacity:"slidey-opacity"};g.forEach(a,function(a){g.isDefined(a)&&(a.transition.addSuite(F),g.forEach(d,function(b){if(h.hasOwnProperty(b)){var c=
b.replace(/\[.*\]/,"");a.transition.bind(c,h[b])}}))})}}};(function(){g.module("flLayout",[],["$provide",function(b){b.directive({aLayout:H,aBlock:G,aScreen:I,anOverlay:J,anOverlayPanel:K,beSlidey:L});b.provider({$jQuery:$JQueryProvider,windowResizeWatcher:E,augmentController:B,transition:C})}])})()})(window,window.angular);angular.element(document).find("head").append('<style type="text/css"></style>');
